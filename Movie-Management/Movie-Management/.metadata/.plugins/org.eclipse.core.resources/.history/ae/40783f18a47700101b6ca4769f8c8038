package com.wipro.mohan.controller;

import com.wipro.mohan.entities.Theatre;
import com.wipro.mohan.service.TheatreService;

import io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/theatres")
@RequiredArgsConstructor
public class TheatreController {

    private final TheatreService service;
    @CircuitBreaker(name = "CircuitBreaker",fallbackMethod = "TheatreFallBackMethod")
    @PostMapping("/add")
    public Theatre addTheatre(@RequestBody Theatre theatre) {
        return service.addTheatre(theatre);
    }
    
    public Theatre TheatreFallBackMethod(Theatre theatre, Throwable throwable) {
    	Theatre fallBack=new Theatre();
    	fallBack.setTheatreName("Theatre creation failed, please try again later. ");
    	fallBack.setCity("Unknown");
    	return fallBack;
    }

    @GetMapping("/getTheatres")
    public List<Theatre> getTheatres() {
        return service.getTheatres();
    }

    // returns ONLY movies from the Movie service
    @GetMapping("/{id}/movies")
    public List<Map<String, Object>> getMoviesForTheatre(@PathVariable Long id) {
        return service.getMoviesForTheatre(id);
    }
}